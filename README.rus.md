Luabind
=======

[![Travis CI build status](https://travis-ci.com/Oberon00/luabind.svg?branch=master)](https://travis-ci.com/github/Oberon00/luabind)


Luabind - это библиотека, которая помогает вам создавать привязки между C++ и Lua. Она
обладает способностью предоставлять функции и классы, написанные на C++, в Lua. 
Также предоставит функциональность для определения классов в lua и позволит им
быть производными от других классов lua или классов C++. Классы Lua могут переопределять виртуальные
функции из своих базовых классов C++. Он написан для Lua 5.x и не работает с Lua 4.

Это реализовано с использованием шаблонного метапрограммирования. Это означает, что вам
не нужен дополнительный проход предварительной обработки для компиляции вашего проекта (это делается с помощью
компилятора). Это также означает, что вам (обычно) не нужно знать точную сигнатуру
каждой регистрируемой вами функции, поскольку библиотека будет генерировать код в зависимости
от типа функции во время компиляции (который включает сигнатуру). 
Основным недостатком такого подхода является то, что время компиляции увеличится для
файла, который выполняет регистрацию, поэтому рекомендуется
регистрировать все в одном и том же cpp-файле.

Luabind выпущен на условиях [лицензии MIT][1].

> Авторское право Дэниел Уоллин, Арвид Норберг 2003.
> Извлечено из <http://www.rasterbar.com/products/luabind/docs.html >

[1]: http://www.opensource.org/licenses/mit-license.php


Эта копия репозитория
---------

Я разветвил проект, так как он кажется заброшенным (последний коммит от января 2012
года в ветке 0.9), и я столкнулся с определенными ошибками, которые требовали исправления (см.
коммиты).

На самом деле это должно было быть разветвлено с [rpavlik/luabind][rpavlik]: я
выбрал большинство коммитов оттуда. Кроме того, многие коммиты из
[fhoefler/luaponte][fhoefling] включены (как они есть в
форке rpavlik). Таким образом, не стесняйтесь делать то же самое с моей вилкой(форком)(копием репозитория).

[rpavlik]: http://github.com/rpavlik/luabind/
[fhoefling]: http://github.com/fhoefling/luaponte

В следующих двух разделах описаны улучшения по сравнению с последней официальной
версией luabind (0.9).

### Исправлены ошибки ###

* У уничтоженных объектов теперь не задан их metatable. Ранее можно
было легко вызвать ошибки сегментации и другое неопределенное поведение, обратившись
к уничтоженным объектам из luabinds `__finalize` или Lua 5.2 `__gc`. Теперь вы
можете просто проверить с помощью `getmetatable(obj)`, и если вы забудете, вместо этого вы получите
обычную, четко определенную ошибку Lua. Commit  [a83aa][c-destroy].
* Часть Lua производного класса `wrap_base` случайным образом была потеряна после нескольких
циклов сборки мусора из-за ошибок в реализации
  внутренний класс `weak_ref`. Благодарность за исправление принадлежит Максу Макгуайру, который
[опубликовал] [mmg-fix] исправление для пользователя luabind в 2010 году. Commit  [a3a400][c-weakref].
* Сообщение об ошибке, отображаемое, когда функция не может быть вызвана из Lua
с предоставленными аргументами, иногда содержало только сигнатуры функций
  но не фактическое сообщение об ошибке. коммит mrwonko [9d15e0][c-errmsg] (и
предыдущий).
* Luabind не работал над разделяемыми библиотеками (DLL) на некоторых
платформах. фиксация fhoefling [a83af3][c-dll] и мое незначительное улучшение
  [a8349d][c-dll2].
* Вызов `call_function` с типом возврата, но не использование его привело к
вызову `std::terminate`, если вызванная функция выдала ошибку и
используется компилятор, совместимый с C++11. Commit  [81bdcb][c-noexpect].
* Luabind не удалось правильно распознать номера Lua в MSVC x64. Совершать
  [c9582c][c-longlong].


* Luabind не удалось скомпилировать на g++ с Boost 1.49
  (Проблема `BOOST_PP_ITERATION_FLAGS`). Commit [1aa80b][c-gcc-ftbsfs].
* Luabind не удалось скомпилировать на Clang. Commit [4555b2][c-clang-ftbfs].

[c-destroy]: http://github.com/Oberon00/luabind/commit/a83aae710ccb5d4fad2d625e3c87008d450949cb
[mmg-fix]: http://lua.2524044.n2.nabble.com/weak-ref-issue-patch-td7581558.html
[c-weakref]: http://github.com/Oberon00/luabind/commit/a3a400e5fc5f31b5733ad0e595e7f5b474883174
[c-fh-gcc-ftbfs]: http://github.com/fhoefling/luaponte/commit/085f2e06204d6b2710db127806cfa855fca17d79
[c-gcc-ftbsfs]: http://github.com/Oberon00/luabind/commit/1aa80be0bb944e960919542b16c6a3a117a4cdb8
[c-errmsg]: http://github.com/Oberon00/luabind/commit/9d15e0288261ef83b227a3151d8f2ac238ef3759
[c-dll]: http://github.com/Oberon00/luabind/commit/a83af3c69a3cd6da5ba21ea5062205fa664e59d2
[c-dll2]: http://github.com/Oberon00/luabind/commit/a8349dfd94bcc456af5dc4b1bf4f175875d8ae54
[c-longlong]: http://github.com/Oberon00/luabind/commit/c9582cea44fd67301ee5940cf08ccf5ae8c90094
[c-noexpect]: http://github.com/Oberon00/luabind/commit/81bdcb72aa6ef7b321e59416b77be65c3944d6a9
[c-clang-ftbfs]: http://github.com/Oberon00/luabind/commit/4555b20f0553f073d9d9085a43174aea5f7abaa6

### Добавлены функции ###

* CMake заменяет сломанный Jamfile в качестве системы сборки (включая установку
и поддержку тестирования).
  Также предоставляется файл [`FindLuabind.cmake`][findluabind], а также
  [`FindLua52.cmake`][найдиlua52].
* Небольшая поддержка C++11:
    + `std::shared_ptr` поддерживается в качестве интеллектуального указателя через
      [`luabind/std_shared_ptr_converter.hpp`][stdptr].
      Commit [118f80][c-11-ptr].
    + Перечисления с ограниченной областью действия можно использовать с `enum_`.
    + Базовая поддержка ссылок на значения rvalue. фиксация Фофлинга [a83af3][c-11-rval].
    + Поддержка `long-long`. Commit [c9582c][c-longlong] (также для компиляторов, поддерживающих его до C++11).
* Новая функция (C++) `set_package_preload` может быть использована для регистрации
функции (загрузчика), которая будет вызываться только в том случае, если она "требуется" из
фиксации Lua. rpavlik [3502e9][c-preload].
* Модули теперь могут регистрировать все в произвольных таблицах
  (`luabind::object's). фиксация Фофлинга [dd4a16][c-таблица]. Это
очень хорошо сочетается с `set_package_preload`.
* Оператор по модулю `%` теперь может быть экспортирован в фиксацию Lua. rpavlik
  [855b4a][c-по модулю] и следующее.
* `class_info` теперь может обрабатывать фактические классы в качестве аргументов. Раньше это могло
  обрабатывайте только *объекты* классов luabind. фиксация rpavlik's commit
  [c2ee1f][c-classinfo].

[findluabind]: cmake/Modules/FindLuabind.cmake
[findlua52]: cmake/Modules/FindLua52.cmake
[stdptr]: luabind/std_shared_ptr_converter.hpp
[c-11-ptr]: http://github.com/Oberon00/luabind/commit/118f808b068e93e78fc717749f757a2358b9a4af
[c-11-rval]: http://github.com/Oberon00/luabind/commit/a83af3c69a3cd6da5ba21ea5062205fa664e59d2
[c-classinfo]: http://github.com/Oberon00/luabind/commit/c2ee1f82598eb3ded6922e05decdcc7bb69a8d2a
[c-preload]: http://github.com/Oberon00/luabind/commit/3502e9c7234daf1b12f6dc7f545d361d5cee105d
[c-table]: http://github.com/Oberon00/luabind/commit/dd4a1695dcbabbe1541f229ff245178b0621cf0d
[c-modulo]: http://github.com/Oberon00/luabind/commit/855b4afba0204d0ae6e8fbd251dfc71f4d84353e

Кроме того, удаление многих строк кода смерти, также неиспользуемых (частей)
переменные-члены и другие незначительные улучшения делают luabind в целом
(немного) быстрее и менее требовательным к памяти.

Также были исправлены многие предупреждения компилятора. Остальные (нерелевантные)
отключены, поэтому сборка должна быть полностью без предупреждений (и, конечно
же, без ошибок) на Clang, g++ и MSVC.

Этот форк полностью совместим с исходным кодом (API) оригинальной библиотеки luabind,
но не совместим с двоичным кодом.